spark-shell --master local[*]
val lines = sc.textFile("hdfs://cshadoop1/yelpdatafall/review/review.csv")
val ratingSums = lines.map(line => line.split("\\^")).map(line=>(line(2),line(3).toDouble)).reduceByKey(_+_)
val counts = lines.map(line => line.split("\\^")).map(line => (line(2),1)).reduceByKey(_+_)
val avgs =  ratingSums.join(counts).mapValues{ case(sum, count) => (1.0*sum)/count}.sortByKey(true,1).map(x => x.swap)
val maxRating = avgs.sortByKey(false,1).map(x=>x._1).first()  //take first element from dataset
val businessId = avgs.filter( x => x._1 == maxRating).map(x => x.swap).sortByKey(true, 1).take(10).map(x => x._1)
sc.parallelize(businessId).saveAsTextFile("hdfs://cshadoop1/rxy121130/HW2/Q2a")





//res4: Array[Double] = Array(95.0, 26.0, 55.0, 28.0, 10.0, 33.0, 7.0, 104.0, 151.0, 371.0, 23.0, 42.0, 3.0, 5.0, 58.0, 18.0, 268.0, 12.0, 948.0, 226.0, 31.0, 5.0, 9.0, 224.0, 27.0, 85.0, 28.0, 269.0, 268.0, 54.0, 10.0, 9.0, 102.0, 309.0, 6.0, 66.0, 11.0, 93.0, 10.0, 17.0, 1.0, 109.0, 16.0, 548.0, 21.0, 54.0, 55.0, 442.0, 21.0, 79.0, 12.0, 29.0, 140.0, 6.0, 8.0, 30.0, 10.0, 9.0, 4.0, 86.0, 14.0, 59.0, 9.0, 10.0, 10.0, 21.0, 15.0, 407.0, 42.0, 10.0, 63.0, 8.0, 1142.0, 19.0, 32.0, 10.0, 46.0, 280.0, 4.0, 131.0, 8.0, 8.0, 161.0, 7.0, 15.0, 30.0, 11.0, 5.0, 28.0, 65.0, 34.0, 16.0, 44.0, 486.0, 12.0, 20.0, 29.0, 12.0, 35.0, 3.0, 8.0, 27.0, 42.0, 74.0, 11.0, 27.0, 10.0, 15.0, 69.0, 8.0, 13.0, 8.0, 38.0, 116.0, 16.0, 9.0, 5.0, 53.0, 15.0, 8.0, 27.0, 10.0, 3.0, 40.0, 179.0, 31.0, 9.0, 21.0, 9.0, ...


//res3: Array[Int] = Array(26, 10, 13, 11, 2, 14, 2, 28, 48, 106, 6, 11, 2, 1, 13, 7, 64, 3, 271, 53, 8, 1, 4, 68, 9, 20, 10, 97, 71, 17, 2, 2, 33, 89, 2, 14, 3, 23, 2, 6, 1, 28, 4, 184, 7, 18, 14, 122, 6, 20, 3, 7, 52, 2, 4, 6, 3, 3, 2, 39, 5, 20, 2, 4, 2, 6, 4, 114, 12, 2, 15, 2, 356, 5, 8, 2, 16, 83, 2, 32, 2, 2, 39, 3, 3, 8, 3, 2, 7, 22, 7, 7, 10, 119, 3, 12, 7, 4, 7, 1, 3, 8, 13, 20, 4, 8, 2, 3, 18, 2, 3, 2, 9, 43, 4, 3, 2, 15, 4, 2, 13, 3, 2, 12, 37, 7, 2, 7, 3, 30, 6, 4, 2, 27, 4, 8, 7, 12, 22, 32, 7, 7, 3, 2, 7, 257, 14, 2, 83, 20, 36, 4, 2, 13, 4, 2, 14, 4, 211, 12, 36, 2, 4, 13, 325, 3, 15, 4, 92, 4, 2, 2, 17, 3, 3, 3, 30, 122, 5, 5, 5, 3, 2, 2, 6, 2, 2, 1178, 2, 225, 312, 13, 2, 4, 10, 5, 8, 3, 19, 2, 9, 5, 5, 3, 7, 2, 2, 48, 3, 2, 1, 37, 2, 8, 19, 17, 59, 28, 7, 2, 5, 81, 4, 1...

//res5: Array[Double] = Array(3.8181818181818183, 3.0, 4.111111111111111, 2.925, 2.8095238095238093, 3.869047619047619, 3.8333333333333335, 4.1, 4.166666666666667, 3.5, 4.666666666666667, 2.0, 2.5, 4.0, 2.5, 3.842857142857143, 4.333333333333333, 3.4, 3.5164835164835164, 2.5, 4.4, 4.25, 3.82, 3.5714285714285716, 2.5, 2.0, 3.75, 5.0, 2.2038216560509554, 3.7142857142857144, 2.0, 4.0, 2.9130434782608696, 3.75, 5.0, 5.0, 4.2, 3.875, 3.0, 3.7142857142857144, 4.5, 4.0, 3.7142857142857144, 4.153846153846154, 3.3181818181818183, 4.390804597701149, 4.0, 4.2727272727272725, 4.0, 2.7058823529411766, 3.0357142857142856, 3.3333333333333335, 3.7, 3.2222222222222223, 2.0, 2.8333333333333335, 3.0545454545454547, 3.3333333333333335, 2.5, 3.5, 3.9, 3.25, 3.0, 3.0, 4.6, 3.25, 1.0, 3.8666666666666667, 3.6, 4....
